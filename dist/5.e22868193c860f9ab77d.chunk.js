webpackJsonp([5],{771:function(e,n,a){a(791);var t=a(281)(a(784),a(805),null,null);t.options.__file="E:\\project\\ranqibaojingpingtai\\src\\views\\map\\Map.vue",t.esModule&&Object.keys(t.esModule).some(function(e){return"default"!==e&&"__esModule"!==e})&&console.error("named exports are not supported in *.vue files."),t.options.functional&&console.error("[vue-loader] Map.vue: functional components are not supported with templates, they should use render functions."),e.exports=t.exports},784:function(e,n,a){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={name:"map",data:function(){return{pointData:[],street:[],markers:[],opts:{width:640,height:400,enableMessage:!0}}},mounted:function(){var e=new BMap.Map("map",{enableMapClick:!1});e.enableScrollWheelZoom(!0),e.setMapStyle({styleJson:[{featureType:"railway",elementType:"geometry.stroke",stylers:{visibility:"off"}},{featureType:"label",elementType:"all",stylers:{}}]}),this.getBoundary(e),this.makePoint(e),e.addEventListener("tilesloaded",function(){})},methods:{getBoundary:function(e){(new BMap.Boundary).get("南京市秦淮区",function(n){var a=n.boundaries.length;if(0===a)return void alert("未能获取当前输入行政区域");for(var t=[],i=0;i<a;i++){var o=new BMap.Polygon(n.boundaries[i],{strokeWeight:2,strokeColor:"#f00",fillColor:""});e.addOverlay(o),t=t.concat(o.getPath())}e.setViewport(t)})},makePoint:function(e){var n=this;e.clearOverlays(),this.axios("http://58.213.47.166:8990/area/devices?aid=2086&pageNumber=1&pageSize=10000").then(function(a){n.pointData=a.data.rows,n.pointData.forEach(function(a,t){n.axios("http://58.213.47.166:8990/device/belong?did="+a.id).then(function(e){n.$set(n.pointData[t],"name",e.data.belong.name),n.$set(n.pointData[t],"tel",e.data.belong.tel)});for(var i=0;i<n.street.length;i++)a.sid==n.street[i].sid&&n.$set(n.pointData[t],"address","江苏省 南京市 秦淮区 "+n.street[i].n+" "+n.pointData[t].address);var o=new BMap.Point(a.x,a.y),s=new BMap.Icon("./img/marker1.png",new BMap.Size(40,40)),r=new BMap.Marker(o,{icon:s});n.markers.push(r),r.setTitle(a.address),e.addOverlay(r),setTimeout(function(){this.addClickHandler(e,a,r)}.bind(n),100),n.watchPoint(e,a,r)}),console.log(e),console.log(n.markers);new BMapLib.MarkerClusterer(e,{markers:n.markers})})},watchPoint:function(e,n,a){clearInterval(a.setInt),a.setInt=setInterval(function(){this.axios("http://service.wanwuyun.com:8920/devicedata/"+n.seckey+"?count=1").then(function(e){if(e.data.data.length>=1&&(e.data.data[0].ALARM="2","2"==e.data.data[0].ALARM))if(a.infoCreateTime){var n=(new Date).getTime(),t=n-a.infoCreateTime;if(t>3e4){a.isWarn=!0,a.setAnimation(BMAP_ANIMATION_BOUNCE);var i=new BMap.Icon("./img/marker2.png",new BMap.Size(40,40),{});a.setIcon(i)}}else{a.isWarn=!0,a.setAnimation(BMAP_ANIMATION_BOUNCE);var o=new BMap.Icon("./img/marker2.png",new BMap.Size(40,40),{});a.setIcon(o)}})}.bind(this),2500)},addClickHandler:function(e,n,a){var t=this,i="",o="";new Promise(function(e){t.axios("http://58.213.47.166:8990/area/alarms?aid=2086&pageNumber=1&pageSize=1000").then(function(a){a.data.rows.forEach(function(e,a){n.id==e.dId&&(o+='<tr><td class="time">'+e.date.slice(0,e.date.indexOf("."))+'</td><td class="tel">推送'+e.alarmTel.replace(/,/g,"  ")+"</td></tr>")}),e(o)})}).then(function(e){var a='<div class="deviceInfor"><div class="deviceUserInfor"><p><i class="ivu-icon icon-user"></i><b>户 主</b>：<span>'+n.name+'</span></p><p><i class="ivu-icon icon-dianhua"></i><b>联 系 方 式</b>：<span>'+n.tel+'</span></p><p><i class="ivu-icon icon-device"></i><b>设 备 号</b>：<span>'+n.imsi+'</span></p><p><i class="ivu-icon icon-dingwei"></i><b>地 址</b>：<span>'+n.address+'</span></p></div><div class="deviceAlarmInfor"><h3><i class="ivu-icon icon-tanhao"></i><b>报 警 记 录</b></h3><table class="alarmTable">';i+=a+e+"</table></div></div>"}),a.addEventListener("click",function(t){a.setAnimation(null),clearInterval(a.setInt),this.openInfo(a,e,i,t),a.infoCreateTime=(new Date).getTime(),this.watchPoint(e,n,a)}.bind(this))},openInfo:function(e,n,a,t){var i=t.target,o=new BMap.Point(i.getPosition().lng,i.getPosition().lat),s=new BMap.InfoWindow(a,this.opts);s.addEventListener("close",function(n){console.log("关闭了"),console.log(e);var a=new BMap.Icon("./img/marker1.png",new BMap.Size(40,40),{});e.setIcon(a)}.bind(this)),new Promise(function(e){n.openInfoWindow(s,o),e()}).then(function(){setTimeout(function(){console.log(e.isWarn);var n=document.getElementsByClassName("BMap_pop")[0];console.log(n.className),console.log(n),e.isWarn?function(e,n){for(var a=e.className,t=""!=a?" ":"",i=a+t+n,o=i.split(" "),s=[],r=0;r<o.length;r++)-1==s.indexOf(o[r])&&s.push(o[r]);e.className=s.join(" ")}(n,"active"):function(e,n){var a=" "+e.className+" ";a=a.replace(/(\s+)/gi," ");var t=a.replace(" "+n+" "," ");t=t.replace(/(^\s+)|(\s+$)/g,""),e.className=t}(n,"active"),e.isWarn=!1})})}},created:function(){var e=this;this.axios.get("http://58.213.47.166:8990/area/street?aid=2086").then(function(n){e.street=n.data})}}},791:function(e,n){throw new Error('Module build failed: ModuleBuildError: Module build failed: \r\n        {\r\n       ^\r\n      Invalid CSS after "        height": expected "}", was ":100%;"\r\n      in E:\\project\\ranqibaojingpingtai\\src\\views\\map\\Map.vue (line 41, column 9)\n    at runLoaders (E:\\project\\ranqibaojingpingtai\\node_modules\\webpack\\lib\\NormalModule.js:192:19)\n    at E:\\project\\ranqibaojingpingtai\\node_modules\\loader-runner\\lib\\LoaderRunner.js:364:11\n    at E:\\project\\ranqibaojingpingtai\\node_modules\\loader-runner\\lib\\LoaderRunner.js:230:18\n    at context.callback (E:\\project\\ranqibaojingpingtai\\node_modules\\loader-runner\\lib\\LoaderRunner.js:111:13)\n    at Object.onRender (E:\\project\\ranqibaojingpingtai\\node_modules\\sass-loader\\index.js:273:13)\n    at Object.<anonymous> (E:\\project\\ranqibaojingpingtai\\node_modules\\async\\dist\\async.js:2244:31)\n    at Object.callback (E:\\project\\ranqibaojingpingtai\\node_modules\\async\\dist\\async.js:906:16)\n    at options.error (E:\\project\\ranqibaojingpingtai\\node_modules\\node-sass\\lib\\index.js:289:32)')},805:function(e,n,a){e.exports={render:function(){var e=this,n=e.$createElement;e._self._c;return e._m(0)},staticRenderFns:[function(){var e=this,n=e.$createElement,a=e._self._c||n;return a("div",{staticClass:"map"},[a("div",{attrs:{id:"map"}})])}]},e.exports.render._withStripped=!0}});