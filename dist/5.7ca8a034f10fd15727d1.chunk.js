webpackJsonp([5],{771:function(e,a,t){t(788);var n=t(281)(t(784),t(803),null,null);n.options.__file="E:\\project\\ranqibaojingpingtai\\src\\views\\map\\Map2.vue",n.esModule&&Object.keys(n.esModule).some(function(e){return"default"!==e&&"__esModule"!==e})&&console.error("named exports are not supported in *.vue files."),n.options.functional&&console.error("[vue-loader] Map2.vue: functional components are not supported with templates, they should use render functions."),e.exports=n.exports},784:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default={data:function(){return{bMap:null,streetList:[],markerData:[],areaMarkerData:[],listShow:!0,opts:{width:640,height:420,enableMessage:!0}}},watch:{streetList:function(e){this.$once(this.bMapInit())}},methods:{getStreet:function(){var e=this;this.axios.get("area/street?aid=2086").then(function(a){e.streetList=a.data})},bMapInit:function(){var e=new BMap.Map("map",{enableMapClick:!1});this.bMap=e,e.centerAndZoom(new BMap.Point(118.823513,32.020812),14),e.addControl(new BMap.MapTypeControl),e.setCurrentCity("南京"),e.enableScrollWheelZoom(!0),e.setMapStyle({styleJson:[{featureType:"railway",elementType:"geometry.stroke",stylers:{visibility:"off"}},{featureType:"label",elementType:"all",stylers:{}}]}),this.makePoint(e)},makePoint:function(e){var a=this;e.clearOverlays(),this.axios("area/devices?aid=2086&pageNumber=1&pageSize=10000").then(function(t){var n=t.data.rows;n.forEach(function(t,i){a.axios("device/belong?did="+t.id).then(function(e){n[i].name=e.data.belong.name,n[i].tel=e.data.belong.tel});for(var s=0;s<a.streetList.length;s++)t.sid==a.streetList[s].sid&&(n[i].address="江苏省 南京市 秦淮区 "+a.streetList[s].n+" "+n[i].address);var o=new BMap.Point(t.x,t.y),r=new BMap.Icon("./img/marker1.png",new BMap.Size(39,42)),l=new BMap.Marker(o,{icon:r});l.setTitle(t.address),e.addOverlay(l),l.mesData=n[i],a.$set(l,"isWarn",!1),a.markerData.push(l),a.watchPoint(e,l),a.addClickHandler(e,l)})})},watchPoint:function(e,a){var t=this;clearInterval(a.setInt),a.setInt=setInterval(function(){t.axios("http://service.wanwuyun.com:8920/devicedata/"+a.mesData.seckey+"?count=1").then(function(e){var n=e.data.data;if(n.length>=1)if("2"==n[0].ALARM)if(a.infoCreateTime){var i=(new Date).getTime(),s=i-a.infoCreateTime;if(s>72e4){a.isWarn=!0,a.setAnimation(BMAP_ANIMATION_BOUNCE);var o=new BMap.Icon("./img/marker2.png",new BMap.Size(39,42),{});a.setIcon(o)}}else{a.isWarn=!0,a.setAnimation(BMAP_ANIMATION_BOUNCE);var r=new BMap.Icon("./img/marker2.png",new BMap.Size(39,42),{});a.setIcon(r)}else if("1"==n[0].ALARM);else if("0"==n[0].ALARM){a.isWarn=!1,t.$set(a,"infoCreateTime",!1),a.setAnimation(null);var l=new BMap.Icon("./img/marker1.png",new BMap.Size(39,42),{});a.setIcon(l)}})},1500)},addClickHandler:function(e,a){a.addEventListener("click",function(t){var n=this;a.setAnimation(null),new Promise(function(t){n.geoUtils(e,a),t()}).then(function(){n.openInfo(e,a)})}.bind(this))},clickOpenInfo:function(e){e.isWarn=!1,e.setAnimation(null),e.infoCreateTime=(new Date).getTime(),this.openInfo(this.bMap,e,!0),this.watchPoint(this.bMap,e)},geoUtils:function(e,a){this.areaMarkerData=[];var t=[],n=new BMap.Point(a.point.lng-6e-5,a.point.lat+2e-5),i=new BMap.Point(a.point.lng+6e-5,a.point.lat+2e-5),s=new BMap.Point(a.point.lng+6e-5,a.point.lat-12e-5),o=new BMap.Point(a.point.lng-6e-5,a.point.lat-12e-5);t.push(n),t.push(i),t.push(s),t.push(o);for(var r=new BMap.Polygon(t),l=0;l<this.markerData.length;l++){var c=new BMap.Point(this.markerData[l].point.lng,this.markerData[l].point.lat);1==BMapLib.GeoUtils.isPointInPolygon(c,r)?(this.areaMarkerData.push(this.markerData[l]),this.listShow=!0):console.log("点在范围外")}},openInfo:function(e,a,t){var n=this,i="",s="";new Promise(function(e){var t=[];n.axios("area/alarms?aid=2086&pageNumber=1&pageSize=1000").then(function(n){n.data.rows.forEach(function(e,n){a.mesData.id==e.dId&&t.push(e)}),t<1?(s+='<tr><td class="time" style="text-align:center;">暂无记录</td>',e(s)):(t.forEach(function(e,n){a.mesData.id==e.dId&&(t.push(e),s+='<tr><td class="time">'+e.date.slice(0,e.date.indexOf("."))+'</td><td class="tel">推送'+e.alarmTel.replace(/,/g,"  ")+"</td></tr>")}),e(s))})}).then(function(s){var o='<div class="deviceInfor"><div class="deviceUserInfor"><p><i class="ivu-icon icon-user"></i><b>户 主</b>：<span>'+a.mesData.name+'</span></p><p><i class="ivu-icon icon-dianhua"></i><b>联 系 方 式</b>：<span>'+a.mesData.tel+'</span></p><p><i class="ivu-icon icon-device"></i><b>设 备 名</b>：<span>'+a.mesData.nickname+'</span></p><p><i class="ivu-icon icon-imsi"></i><b>设 备 号</b>：<span>'+a.mesData.imsi+'</span></p><p><i class="ivu-icon icon-dingwei"></i><b>地 址</b>：<span>'+a.mesData.address+'</span></p></div><div class="deviceAlarmInfor"><h3><i class="ivu-icon icon-tanhao"></i><b>报 警 记 录</b></h3><div class="alarmTableWrap"><table class="alarmTable">';if(i+=o+s+"</table><div></div></div>",n.areaMarkerData.length<=1||t){var r=new BMap.Point(a.point.lng,a.point.lat),l=new BMap.InfoWindow(i,n.opts);e.openInfoWindow(l,r),n.infoWindowOpen(l,a),n.infoWindowClose(l,a)}})},infoWindowOpen:function(e,a){e.addEventListener("open",function(e,t,n){var i=this;a.setAnimation(null),a.infoCreateTime=(new Date).getTime();var s=document.getElementsByClassName("BMap_pop")[0];a.isWarn?this.addClass(s,"active"):this.removeClass(s,"active"),this.infoWindowOpen=function(e,a){a.setAnimation(null),a.infoCreateTime=(new Date).getTime(),a.isWarn?i.addClass(s,"active"):i.removeClass(s,"active")}}.bind(this))},infoWindowClose:function(e,a){e.addEventListener("close",function(e){a.isWarn=!1;var t=new BMap.Icon("./img/marker1.png",new BMap.Size(39,42),{});a.setIcon(t)}.bind(this))},closeList:function(){this.listShow=!1},addClass:function(e,a){for(var t=e.className,n=""!=t?" ":"",i=t+n+a,s=i.split(" "),o=[],r=0;r<s.length;r++)-1==o.indexOf(s[r])&&o.push(s[r]);e.className=o.join(" ")},removeClass:function(e,a){var t=" "+e.className+" ";t=t.replace(/(\s+)/gi," ");var n=t.replace(" "+a+" "," ");n=n.replace(/(^\s+)|(\s+$)/g,""),e.className=n}},created:function(){this.getStreet()},computed:{listShows:function(){return this.areaMarkerData.length>1}},mounted:function(){},destroyed:function(){this.markerData.map(function(e){e.setInt&&clearInterval(e.setInt)})}}},788:function(e,a){},803:function(e,a,t){e.exports={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"map"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.listShows&&e.listShow,expression:"listShows&&listShow"}],staticClass:"alarmsList"},[t("div",{staticClass:"closeWrap"},[t("i",{staticClass:"ivu-icon icon-guanbi closeList",on:{click:e.closeList}})]),e._v(" "),t("div",{staticClass:"list"},[t("ul",e._l(e.areaMarkerData,function(a){return t("li",{class:{active:!!a.isWarn},on:{click:function(t){e.clickOpenInfo(a)}}},[t("p",[t("i",{staticClass:"ivu-icon icon-user"}),t("b",[e._v("户 主")]),e._v("："),t("span",[e._v(e._s(a.mesData.name))])]),e._v(" "),t("p",[t("i",{staticClass:"ivu-icon icon-device"}),t("b",[e._v("设 备 名 ")]),e._v("："),t("span",[e._v(e._s(a.mesData.nickname))])]),e._v(" "),t("p",[t("i",{staticClass:"ivu-icon icon-dingwei"}),t("b",[e._v("地 址")]),e._v("："),t("span",[e._v(e._s(a.mesData.address))])])])}))])]),e._v(" "),t("div",{attrs:{id:"map"}})])},staticRenderFns:[]},e.exports.render._withStripped=!0}});