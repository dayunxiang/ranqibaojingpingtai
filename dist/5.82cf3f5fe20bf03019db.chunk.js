webpackJsonp([5],{771:function(e,t,a){a(791);var n=a(281)(a(784),a(806),null,null);n.options.__file="E:\\project\\ranqibaojingpingtai\\src\\views\\map\\Map.vue",n.esModule&&Object.keys(n.esModule).some(function(e){return"default"!==e&&"__esModule"!==e})&&console.error("named exports are not supported in *.vue files."),n.options.functional&&console.error("[vue-loader] Map.vue: functional components are not supported with templates, they should use render functions."),e.exports=n.exports},784:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"map",data:function(){return{pointData:[],street:[],markers:[],rangePoint:[],markersDataList:[],opts:{width:640,height:400,enableMessage:!0}}},mounted:function(){var e=new BMap.Map("map",{enableMapClick:!1});e.centerAndZoom(new BMap.Point(118.823513,32.020812),14),e.addControl(new BMap.MapTypeControl),e.setCurrentCity("南京"),e.enableScrollWheelZoom(!0),e.setMapStyle({styleJson:[{featureType:"railway",elementType:"geometry.stroke",stylers:{visibility:"off"}},{featureType:"poi",elementType:"labels",stylers:{visibility:"off"}},{featureType:"label",elementType:"all",stylers:{}}]}),this.makePoint(e),e.addEventListener("tilesloaded",function(){})},methods:{getBoundary:function(e){(new BMap.Boundary).get("南京市秦淮区",function(t){var a=t.boundaries.length;if(0===a)return void alert("未能获取当前输入行政区域");for(var n=[],i=0;i<a;i++){var s=new BMap.Polygon(t.boundaries[i],{strokeWeight:2,strokeColor:"#f00",fillColor:""});e.addOverlay(s),n=n.concat(s.getPath())}e.setViewport(n)})},makePoint:function(e){var t=this;e.clearOverlays(),this.axios("http://58.213.47.166:8990/area/devices?aid=2086&pageNumber=1&pageSize=10000").then(function(a){t.pointData=a.data.rows,t.pointData.forEach(function(a,n){t.axios("http://58.213.47.166:8990/device/belong?did="+a.id).then(function(e){t.$set(t.pointData[n],"name",e.data.belong.name),t.$set(t.pointData[n],"tel",e.data.belong.tel)});for(var i=0;i<t.street.length;i++)a.sid==t.street[i].sid&&t.$set(t.pointData[n],"address","江苏省 南京市 秦淮区 "+t.street[i].n+" "+t.pointData[n].address);var s=new BMap.Point(a.x,a.y),r=new BMap.Icon("./img/marker1.png",new BMap.Size(39,42)),o=new BMap.Marker(s,{icon:r});o.did=a.id,t.markers.push(o),o.setTitle(a.address),e.addOverlay(o),setTimeout(function(){this.addClickHandler(e,a,o)}.bind(t),100),t.watchPoint(e,a,o)})})},watchPoint:function(e,t,a){clearInterval(a.setInt),a.setInt=setInterval(function(){var e=this;this.axios("http://service.wanwuyun.com:8920/devicedata/"+t.seckey+"?count=1").then(function(t){if(t.data.data.length>=1&&(t.data.data[0].ALARM="2","2"==t.data.data[0].ALARM))if(a.infoCreateTime){var n=(new Date).getTime(),i=n-a.infoCreateTime;if(i>3e4){e.$set(a,"isWarn",!0),a.setAnimation(BMAP_ANIMATION_BOUNCE);var s=new BMap.Icon("./img/marker2.png",new BMap.Size(39,42),{});a.setIcon(s)}}else{e.$set(a,"isWarn",!0),a.setAnimation(BMAP_ANIMATION_BOUNCE);var r=new BMap.Icon("./img/marker2.png",new BMap.Size(39,42),{});a.setIcon(r)}})}.bind(this),2500)},addClickHandler:function(e,t,a){a.addEventListener("click",function(n){a.setAnimation(null),this.geoUtils(a,e,n),this.rangePoint.length<=1&&(clearInterval(a.setInt),this.openInfo(a,t,e),a.infoCreateTime=(new Date).getTime(),this.watchPoint(e,t,a))}.bind(this))},geoUtils:function(e,t,a,n){this.rangePoint=[],this.markersDataList=[];for(var i=new BMap.Point(e.point.lng,e.point.lat),s=new BMap.Circle(i,50),r=0;r<this.markers.length;r++){var o=new BMap.Point(this.markers[r].point.lng,this.markers[r].point.lat);if(1==BMapLib.GeoUtils.isPointInCircle(o,s)){for(var l=0;l<this.pointData.length;l++)this.markers[r].did==this.pointData[l].id&&(this.$set(this.pointData[l],"isWarn",this.markers[r].isWarn||!1),this.$set(this.pointData[l],"marker",this.markers[r]),this.$set(this.pointData[l],"map",t),this.markersDataList.push(this.pointData[l]));this.rangePoint.push(this.markers[r])}}},clickOpenInfo:function(e){this.$set(e,"isWarn",!1),e.marker.setAnimation(null),clearInterval(e.marker.setInt),this.openInfo(e.marker,e,e.map,!0),e.marker.infoCreateTime=(new Date).getTime(),this.watchPoint(e.map,e,e.marker)},openInfo:function(e,t,a,n){var i=this,s="",r="";new Promise(function(e){i.axios("http://58.213.47.166:8990/area/alarms?aid=2086&pageNumber=1&pageSize=1000").then(function(a){a.data.rows.forEach(function(e,a){t.id==e.dId&&(r+='<tr><td class="time">'+e.date.slice(0,e.date.indexOf("."))+'</td><td class="tel">推送'+e.alarmTel.replace(/,/g,"  ")+"</td></tr>")}),e(r)})}).then(function(r){var o='<div class="deviceInfor"><div class="deviceUserInfor"><p><i class="ivu-icon icon-user"></i><b>户 主</b>：<span>'+t.name+'</span></p><p><i class="ivu-icon icon-dianhua"></i><b>联 系 方 式</b>：<span>'+t.tel+'</span></p><p><i class="ivu-icon icon-device"></i><b>设 备 号</b>：<span>'+t.imsi+'</span></p><p><i class="ivu-icon icon-dingwei"></i><b>地 址</b>：<span>'+t.address+'</span></p></div><div class="deviceAlarmInfor"><h3><i class="ivu-icon icon-tanhao"></i><b>报 警 记 录</b></h3><table class="alarmTable">';if(s+=o+r+"</table></div></div>",i.rangePoint.length<=1||n){var l=new BMap.Point(e.point.lng,e.point.lat),c=new BMap.InfoWindow(s,i.opts);c.addEventListener("close",function(t){var a=new BMap.Icon("./img/marker1.png",new BMap.Size(39,42),{});e.setIcon(a)}.bind(i)),new Promise(function(e){a.openInfoWindow(c,l),e()}).then(function(){setTimeout(function(){var t=document.getElementsByClassName("BMap_pop")[0];e.isWarn?function(e,t){for(var a=e.className,n=""!=a?" ":"",i=a+n+t,s=i.split(" "),r=[],o=0;o<s.length;o++)-1==r.indexOf(s[o])&&r.push(s[o]);e.className=r.join(" ")}(t,"active"):function(e,t){var a=" "+e.className+" ";a=a.replace(/(\s+)/gi," ");var n=a.replace(" "+t+" "," ");n=n.replace(/(^\s+)|(\s+$)/g,""),e.className=n}(t,"active"),i.$set(e,"isWarn",!1)})})}})}},created:function(){var e=this;this.axios.get("http://58.213.47.166:8990/area/street?aid=2086").then(function(t){e.street=t.data})}}},791:function(e,t){},806:function(e,t,a){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"map"},[a("div",{staticClass:"alarmsList"},[a("ul",{directives:[{name:"show",rawName:"v-show",value:e.markersDataList.length>1,expression:"markersDataList.length>1?true:false"}]},e._l(e.markersDataList,function(t){return a("li",{class:{active:!!t.isWarn||!!t.marker.isWarn},on:{click:function(a){e.clickOpenInfo(t)}}},[a("p",[a("i",{staticClass:"ivu-icon icon-user"}),a("b",[e._v("户 主")]),e._v("："),a("span",[e._v(e._s(t.name))])]),e._v(" "),a("p",[a("i",{staticClass:"ivu-icon icon-device"}),a("b",[e._v("设 备 名 称")]),e._v("："),a("span",[e._v(e._s(t.nickname))])]),e._v(" "),a("p",[a("i",{staticClass:"ivu-icon icon-dingwei"}),a("b",[e._v("地 址")]),e._v("："),a("span",[e._v(e._s(t.address))])])])}))]),e._v(" "),a("div",{attrs:{id:"map"}})])},staticRenderFns:[]},e.exports.render._withStripped=!0}});