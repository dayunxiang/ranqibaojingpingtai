webpackJsonp([5],{771:function(e,t,a){a(791);var n=a(281)(a(784),a(806),null,null);n.options.__file="E:\\project\\ranqibaojingpingtai\\src\\views\\map\\Map.vue",n.esModule&&Object.keys(n.esModule).some(function(e){return"default"!==e&&"__esModule"!==e})&&console.error("named exports are not supported in *.vue files."),n.options.functional&&console.error("[vue-loader] Map.vue: functional components are not supported with templates, they should use render functions."),e.exports=n.exports},784:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"map",data:function(){return{pointData:[],street:[],markers:[],rangePoint:[],markersDataList:[],listShow:!0,opts:{width:640,height:400,enableMessage:!0}}},computed:{listShows:function(){return this.markersDataList.length>1}},watch:{street:function(e){this.$once(this.bMapInit())}},mounted:function(){},methods:{bMapInit:function(){var e=new BMap.Map("map",{enableMapClick:!1});e.centerAndZoom(new BMap.Point(118.823513,32.020812),14),e.addControl(new BMap.MapTypeControl),e.setCurrentCity("南京"),e.enableScrollWheelZoom(!0),e.setMapStyle({styleJson:[{featureType:"railway",elementType:"geometry.stroke",stylers:{visibility:"off"}},{featureType:"label",elementType:"all",stylers:{}}]}),this.makePoint(e),e.addEventListener("tilesloaded",function(){})},getBoundary:function(e){(new BMap.Boundary).get("南京市秦淮区",function(t){var a=t.boundaries.length;if(0===a)return void alert("未能获取当前输入行政区域");for(var n=[],i=0;i<a;i++){var s=new BMap.Polygon(t.boundaries[i],{strokeWeight:2,strokeColor:"#f00",fillColor:""});e.addOverlay(s),n=n.concat(s.getPath())}e.setViewport(n)})},makePoint:function(e){var t=this;e.clearOverlays(),this.axios("http://61.147.166.206:8959/ga/area/devices?aid=2086&pageNumber=1&pageSize=10000").then(function(a){t.pointData=a.data.rows,t.pointData.forEach(function(a,n){t.axios("http://61.147.166.206:8959/ga/device/belong?did="+a.id).then(function(e){t.$set(t.pointData[n],"name",e.data.belong.name),t.$set(t.pointData[n],"tel",e.data.belong.tel)});for(var i=0;i<t.street.length;i++)a.sid==t.street[i].sid&&t.$set(t.pointData[n],"address","江苏省 南京市 秦淮区 "+t.street[i].n+" "+t.pointData[n].address);var s=new BMap.Point(a.x,a.y),o=new BMap.Icon("./img/marker1.png",new BMap.Size(39,42)),r=new BMap.Marker(s,{icon:o});r.did=a.id,t.markers.push(r),r.setTitle(a.address),e.addOverlay(r),t.$set(r,"clickOnOff",!1),setTimeout(function(){this.addClickHandler(e,a,r)}.bind(t),100),t.watchPoint(e,a,r)})})},watchPoint:function(e,t,a){var n=this;clearInterval(a.setInt),a.setInt=setInterval(function(){n.axios("http://service.wanwuyun.com:8920/devicedata/"+t.seckey+"?count=1").then(function(e){if(e.data.data.length>=1)if("2"==e.data.data[0].ALARM)if(a.infoCreateTime){var t=(new Date).getTime(),i=t-a.infoCreateTime;if(i>72e4){n.$set(a,"isWarn",!0),a.setAnimation(BMAP_ANIMATION_BOUNCE);var s=new BMap.Icon("./img/marker2.png",new BMap.Size(39,42),{});a.setIcon(s)}}else{n.$set(a,"isWarn",!0),a.setAnimation(BMAP_ANIMATION_BOUNCE);var o=new BMap.Icon("./img/marker2.png",new BMap.Size(39,42),{});a.setIcon(o)}else"0"==e.data.data[0].ALARM&&n.$set(a,"infoCreateTime",!1)})},2500)},addClickHandler:function(e,t,a){a.addEventListener("click",function(n){a.setAnimation(null),a.isWarn&&this.$set(a,"clickOnOff",!0),this.geoUtils(a,e,n),this.rangePoint.length<=1&&(clearInterval(a.setInt),this.openInfo(a,t,e),a.infoCreateTime=(new Date).getTime(),this.watchPoint(e,t,a))}.bind(this))},geoUtils:function(e,t,a,n){this.rangePoint=[],this.markersDataList=[];for(var i=new BMap.Point(e.point.lng,e.point.lat),s=new BMap.Circle(i,10),o=0;o<this.markers.length;o++){var r=new BMap.Point(this.markers[o].point.lng,this.markers[o].point.lat);if(1==BMapLib.GeoUtils.isPointInCircle(r,s)){for(var c=0;c<this.pointData.length;c++)this.markers[o].did==this.pointData[c].id&&(this.$set(this.pointData[c],"isWarn",this.markers[o].isWarn||!1),this.$set(this.pointData[c],"marker",this.markers[o]),this.$set(this.pointData[c],"map",t),this.markersDataList.push(this.pointData[c]),this.listShow=!0);this.rangePoint.push(this.markers[o])}}},clickOpenInfo:function(e){this.$set(e,"isWarn",!1),e.marker.setAnimation(null),clearInterval(e.marker.setInt),this.openInfo(e.marker,e,e.map,!0),e.marker.infoCreateTime=(new Date).getTime(),this.watchPoint(e.map,e,e.marker)},openInfo:function(e,t,a,n){var i=this,s="",o="";new Promise(function(e){i.axios("http://61.147.166.206:8959/ga/area/alarms?aid=2086&pageNumber=1&pageSize=1000").then(function(a){a.data.rows.forEach(function(e,a){t.id==e.dId&&(o+='<tr><td class="time">'+e.date.slice(0,e.date.indexOf("."))+'</td><td class="tel">推送'+e.alarmTel.replace(/,/g,"  ")+"</td></tr>")}),e(o)})}).then(function(o){var r='<div class="deviceInfor"><div class="deviceUserInfor"><p><i class="ivu-icon icon-user"></i><b>户 主</b>：<span>'+t.name+'</span></p><p><i class="ivu-icon icon-dianhua"></i><b>联 系 方 式</b>：<span>'+t.tel+'</span></p><p><i class="ivu-icon icon-device"></i><b>设 备 号</b>：<span>'+t.imsi+'</span></p><p><i class="ivu-icon icon-dingwei"></i><b>地 址</b>：<span>'+t.address+'</span></p></div><div class="deviceAlarmInfor"><h3><i class="ivu-icon icon-tanhao"></i><b>报 警 记 录</b></h3><div class="alarmTableWrap"><table class="alarmTable">';if(s+=r+o+"</table><div></div></div>",i.rangePoint.length<=1||n){var c=new BMap.Point(e.point.lng,e.point.lat),l=new BMap.InfoWindow(s,i.opts);l.addEventListener("close",function(t){var a=new BMap.Icon("./img/marker1.png",new BMap.Size(39,42),{});e.setIcon(a)}.bind(i)),new Promise(function(e){a.openInfoWindow(l,c),e()}).then(function(){setTimeout(function(){var t=document.getElementsByClassName("BMap_pop")[0];e.isWarn?function(e,t){for(var a=e.className,n=""!=a?" ":"",i=a+n+t,s=i.split(" "),o=[],r=0;r<s.length;r++)-1==o.indexOf(s[r])&&o.push(s[r]);e.className=o.join(" ")}(t,"active"):function(e,t){var a=" "+e.className+" ";a=a.replace(/(\s+)/gi," ");var n=a.replace(" "+t+" "," ");n=n.replace(/(^\s+)|(\s+$)/g,""),e.className=n}(t,"active"),i.$set(e,"isWarn",!1)})})}})},closeList:function(){this.listShow=!1}},destroyed:function(){this.markers.map(function(e){clearInterval(e.setInt)})},created:function(){var e=this;this.axios.get("http://61.147.166.206:8959/ga/area/street?aid=2086").then(function(t){e.street=t.data})}}},791:function(e,t){},806:function(e,t,a){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"map"},[a("div",{staticClass:"alarmsList"},[a("i",{staticClass:"ivu-icon icon-guanbi closeList",on:{click:e.closeList}}),e._v(" "),a("ul",{directives:[{name:"show",rawName:"v-show",value:e.listShows&&e.listShow,expression:"listShows&&listShow"}]},e._l(e.markersDataList,function(t){return a("li",{class:{active:!!t.isWarn||!!t.marker.isWarn},on:{click:function(a){e.clickOpenInfo(t)}}},[a("p",[a("i",{staticClass:"ivu-icon icon-user"}),a("b",[e._v("户 主")]),e._v("："),a("span",[e._v(e._s(t.name))])]),e._v(" "),a("p",[a("i",{staticClass:"ivu-icon icon-device"}),a("b",[e._v("设 备 名 称")]),e._v("："),a("span",[e._v(e._s(t.nickname))])]),e._v(" "),a("p",[a("i",{staticClass:"ivu-icon icon-dingwei"}),a("b",[e._v("地 址")]),e._v("："),a("span",[e._v(e._s(t.address))])])])}))]),e._v(" "),a("div",{attrs:{id:"map"}})])},staticRenderFns:[]},e.exports.render._withStripped=!0}});