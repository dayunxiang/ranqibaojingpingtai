webpackJsonp([5],{771:function(e,t,n){n(791);var a=n(281)(n(784),n(805),null,null);a.options.__file="E:\\project\\ranqibaojingpingtai\\src\\views\\map\\Map.vue",a.esModule&&Object.keys(a.esModule).some(function(e){return"default"!==e&&"__esModule"!==e})&&console.error("named exports are not supported in *.vue files."),a.options.functional&&console.error("[vue-loader] Map.vue: functional components are not supported with templates, they should use render functions."),e.exports=a.exports},784:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"map",data:function(){return{pointData:[],street:[],markers:[],opts:{width:640,height:400,enableMessage:!0}}},mounted:function(){var e=new BMap.Map("map",{enableMapClick:!1});e.enableScrollWheelZoom(!0),e.setMapStyle({styleJson:[{featureType:"railway",elementType:"geometry.stroke",stylers:{visibility:"off"}},{featureType:"label",elementType:"all",stylers:{}}]}),this.getBoundary(e),this.makePoint(e),e.addEventListener("tilesloaded",function(){})},methods:{getBoundary:function(e){(new BMap.Boundary).get("南京市秦淮区",function(t){var n=t.boundaries.length;if(0===n)return void alert("未能获取当前输入行政区域");for(var a=[],i=0;i<n;i++){var o=new BMap.Polygon(t.boundaries[i],{strokeWeight:2,strokeColor:"#f00",fillColor:""});e.addOverlay(o),a=a.concat(o.getPath())}e.setViewport(a)})},makePoint:function(e){var t=this;e.clearOverlays(),this.axios("http://58.213.47.166:8990/area/devices?aid=2086&pageNumber=1&pageSize=10000").then(function(n){t.pointData=n.data.rows,t.pointData.forEach(function(n,a){t.axios("http://58.213.47.166:8990/device/belong?did="+n.id).then(function(e){t.$set(t.pointData[a],"name",e.data.belong.name),t.$set(t.pointData[a],"tel",e.data.belong.tel)});for(var i=0;i<t.street.length;i++)n.sid==t.street[i].sid&&t.$set(t.pointData[a],"address","江苏省 南京市 秦淮区 "+t.street[i].n+" "+t.pointData[a].address);var o=new BMap.Point(n.x,n.y),s=new BMap.Icon("./img/marker1.png",new BMap.Size(40,40)),r=new BMap.Marker(o,{icon:s});t.markers.push(r),r.setTitle(n.address),e.addOverlay(r),setTimeout(function(){this.addClickHandler(e,n,r)}.bind(t),100),t.watchPoint(e,n,r)}),console.log(e),console.log(t.markers);new BMapLib.MarkerClusterer(e,{markers:t.markers})})},watchPoint:function(e,t,n){clearInterval(n.setInt),n.setInt=setInterval(function(){this.axios("http://service.wanwuyun.com:8920/devicedata/"+t.seckey+"?count=1").then(function(e){if(e.data.data.length>=1&&(e.data.data[0].ALARM="2","2"==e.data.data[0].ALARM))if(n.infoCreateTime){var t=(new Date).getTime(),a=t-n.infoCreateTime;if(a>3e4){n.isWarn=!0,n.setAnimation(BMAP_ANIMATION_BOUNCE);var i=new BMap.Icon("./img/marker2.png",new BMap.Size(40,40),{});n.setIcon(i)}}else{n.isWarn=!0,n.setAnimation(BMAP_ANIMATION_BOUNCE);var o=new BMap.Icon("./img/marker2.png",new BMap.Size(40,40),{});n.setIcon(o)}})}.bind(this),2500)},addClickHandler:function(e,t,n){var a=this,i="",o="";new Promise(function(e){a.axios("http://58.213.47.166:8990/area/alarms?aid=2086&pageNumber=1&pageSize=1000").then(function(n){n.data.rows.forEach(function(e,n){t.id==e.dId&&(o+='<tr><td class="time">'+e.date.slice(0,e.date.indexOf("."))+'</td><td class="tel">推送'+e.alarmTel.replace(/,/g,"  ")+"</td></tr>")}),e(o)})}).then(function(e){var n='<div class="deviceInfor"><div class="deviceUserInfor"><p><i class="ivu-icon icon-user"></i><b>户 主</b>：<span>'+t.name+'</span></p><p><i class="ivu-icon icon-dianhua"></i><b>联 系 方 式</b>：<span>'+t.tel+'</span></p><p><i class="ivu-icon icon-device"></i><b>设 备 号</b>：<span>'+t.imsi+'</span></p><p><i class="ivu-icon icon-dingwei"></i><b>地 址</b>：<span>'+t.address+'</span></p></div><div class="deviceAlarmInfor"><h3><i class="ivu-icon icon-tanhao"></i><b>报 警 记 录</b></h3><table class="alarmTable">';i+=n+e+"</table></div></div>"}),n.addEventListener("click",function(a){n.setAnimation(null),clearInterval(n.setInt),this.openInfo(n,e,i,a),n.infoCreateTime=(new Date).getTime(),this.watchPoint(e,t,n)}.bind(this))},openInfo:function(e,t,n,a){var i=a.target,o=new BMap.Point(i.getPosition().lng,i.getPosition().lat),s=new BMap.InfoWindow(n,this.opts);s.addEventListener("close",function(t){console.log("关闭了"),console.log(e);var n=new BMap.Icon("./img/marker1.png",new BMap.Size(40,40),{});e.setIcon(n)}.bind(this)),new Promise(function(e){t.openInfoWindow(s,o),e()}).then(function(){setTimeout(function(){console.log(e.isWarn);var t=document.getElementsByClassName("BMap_pop")[0];console.log(t.className),console.log(t),e.isWarn?function(e,t){for(var n=e.className,a=""!=n?" ":"",i=n+a+t,o=i.split(" "),s=[],r=0;r<o.length;r++)-1==s.indexOf(o[r])&&s.push(o[r]);e.className=s.join(" ")}(t,"active"):function(e,t){var n=" "+e.className+" ";n=n.replace(/(\s+)/gi," ");var a=n.replace(" "+t+" "," ");a=a.replace(/(^\s+)|(\s+$)/g,""),e.className=a}(t,"active"),e.isWarn=!1})})}},created:function(){var e=this;this.axios.get("http://58.213.47.166:8990/area/street?aid=2086").then(function(t){e.street=t.data})}}},791:function(e,t){},805:function(e,t,n){e.exports={render:function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},staticRenderFns:[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"map"},[n("div",{attrs:{id:"map"}})])}]},e.exports.render._withStripped=!0}});